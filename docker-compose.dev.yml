# Docker Compose simplifié pour le développement
# Utilise SQLite et file cache (pas de MySQL/Redis)
#
# Usage: docker compose -f docker-compose.dev.yml up -d

services:
  # ===========================================
  # Nginx - Serveur Web
  # ===========================================
  nginx:
    build:
      context: ./docker/nginx
      dockerfile: Dockerfile
    container_name: registre_nginx_dev
    restart: unless-stopped
    ports:
      - "${APP_PORT:-8080}:80"
    volumes:
      - .:/var/www/html:delegated
      - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - php
    networks:
      - registre_dev_network

  # ===========================================
  # PHP-FPM - Application Laravel
  # ===========================================
  php:
    build:
      context: .
      dockerfile: docker/php/Dockerfile
      args:
        USER_ID: ${USER_ID:-1000}
        GROUP_ID: ${GROUP_ID:-1000}
    container_name: registre_php_dev
    restart: unless-stopped
    volumes:
      - .:/var/www/html:delegated
      - ./storage:/var/www/html/storage
    environment:
      - APP_NAME=${APP_NAME:-Registre de Permanence (Dev)}
      - APP_ENV=local
      - APP_KEY=${APP_KEY:-}
      - APP_DEBUG=true
      - APP_URL=http://localhost:8080
      - APP_TIMEZONE=Africa/Nouakchott
      - APP_LOCALE=fr
      # SQLite pour le développement
      - DB_CONNECTION=sqlite
      - DB_DATABASE=/var/www/html/database/database.sqlite
      # File cache (pas de Redis)
      - CACHE_STORE=file
      - SESSION_DRIVER=file
      - QUEUE_CONNECTION=sync
      - LOG_CHANNEL=stack
      - LOG_LEVEL=debug
    networks:
      - registre_dev_network

networks:
  registre_dev_network:
    driver: bridge
